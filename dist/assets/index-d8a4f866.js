import{J as w,d as ae,r as m,c as oe,G as re,e as d,o as ne,f as se,g as e,w as t,h as s,C as k,j as u,t as j,m as E,F as ie,z as D,K as S,p as de,k as ue,_ as ce}from"./index-c7a0cc4e.js";import{u as pe}from"./setting-07e2b429.js";import{h as me}from"./moment-fbc5633a.js";const fe=(o,v,c)=>w.get(`/admin/acl/role/${o}/${v}/?roleName=${c}`),_e=o=>o.id?w.put("/admin/acl/role/update",o):w.post("/admin/acl/role",o),ge=o=>w.get("/admin/acl/permission/toAssign/"+o),ve=(o,v)=>w.post("/admin/acl/permission/doAssign/"+o,v),ye=o=>w.delete("/admin/acl/role/remove/"+o),he=o=>(de("data-v-c502009f"),o=o(),ue(),o),ke=he(()=>E("h4",null,"分配菜单与按钮的权限",-1)),we={style:{flex:"auto"}},be=ae({__name:"index",setup(o){let v=pe(),c=m(1),b=m(10),_=m(""),z=m([]),U=m(0),f=m(!1),x=m(),g=m(!1),i=oe({roleName:""}),V=m([]),N=m([]),R=m();re(()=>{y()});const y=async(r=1)=>{c.value=r;let l=await fe(c.value,b.value,_.value);l.code==200&&(U.value=l.data.total,z.value=l.data.records)},M=()=>{y()},O=()=>{y(),_.value=""},H=()=>{v.refsh=!v.refsh},$=()=>{f.value=!0,Object.assign(i,{roleName:"",id:0}),D(()=>{x.value.clearValidate("roleName")})},K=r=>{f.value=!0,Object.assign(i,r),D(()=>{x.value.clearValidate("roleName")})},L={roleName:[{required:!0,trigger:"blur",validator:(r,l,n)=>{l.trim().length>=2?n():n(new Error("职位名称至少两位"))}}]},B=async()=>{await x.value.validate(),(await _e(i)).code==200&&(S({type:"success",message:i.id?"更新成功":"添加成功"}),f.value=!1,y(i.id?c.value:1))},F=async r=>{V.value=[],g.value=!0,Object.assign(i,r);let l=await ge(i.id);l.code==200&&(N.value=l.data,V.value=q(N.value,[]))},G={children:"children",label:"name"},q=(r,l)=>(r.forEach(n=>{n.select&&n.level==4&&l.push(n.id),n.children&&n.children.length>0&&q(n.children,l)}),l),J=async()=>{const r=i.id;let l=R.value.getCheckedKeys(),n=R.value.getHalfCheckedKeys(),C=l.concat(n);(await ve(r,C)).code==200&&(g.value=!1,S({type:"success",message:"分配权限成功"}),window.location.reload())},Q=()=>{g.value=!1,V.value=[]},W=async r=>{(await ye(r)).code==200&&(S({type:"success",message:"删除成功"}),y(z.value.length>1?c.value:c.value-1))},I=r=>me(r).format("yyyy-MM-DD HH:mm:ss");return(r,l)=>{const n=d("el-input"),C=d("el-form-item"),p=d("el-button"),T=d("el-form"),A=d("el-card"),h=d("el-table-column"),X=d("el-popconfirm"),Y=d("el-table"),Z=d("el-pagination"),ee=d("el-dialog"),le=d("el-tree"),te=d("el-drawer");return ne(),se(ie,null,[e(A,null,{default:t(()=>[e(T,{inline:!0,class:"form"},{default:t(()=>[e(C,{label:"职位搜索"},{default:t(()=>[e(n,{placeholder:"请你输入搜索职位关键字",modelValue:s(_),"onUpdate:modelValue":l[0]||(l[0]=a=>k(_)?_.value=a:_=a)},null,8,["modelValue"])]),_:1}),e(C,null,{default:t(()=>[e(p,{type:"primary",size:"default",disabled:!s(_),onClick:O},{default:t(()=>[u("搜索")]),_:1},8,["disabled"]),e(p,{type:"primary",size:"default",onClick:H},{default:t(()=>[u("重置")]),_:1})]),_:1})]),_:1})]),_:1}),e(A,{style:{margin:"10px 0px"}},{default:t(()=>[e(p,{type:"primary",size:"default",icon:"Plus",onClick:$},{default:t(()=>[u("添加职位")]),_:1}),e(Y,{border:"",style:{margin:"10px 0px"},data:s(z)},{default:t(()=>[e(h,{type:"index",align:"center",label:"#"}),e(h,{label:"ID",align:"center",prop:"id"}),e(h,{label:"职位名称",align:"center",prop:"roleName","show-overflow-tooltip":""}),e(h,{label:"创建时间",align:"center","show-overflow-tooltip":"",prop:"createTime"},{default:t(a=>[u(j(I(a.row.createTime)),1)]),_:1}),e(h,{label:"更新时间",align:"center","show-overflow-tooltip":"",prop:"updateTime"},{default:t(a=>[u(j(I(a.row.updateTime)),1)]),_:1}),e(h,{label:"操作",width:"280px",align:"center"},{default:t(({row:a,$index:xe})=>[e(p,{type:"primary",size:"small",icon:"User",onClick:P=>F(a)},{default:t(()=>[u("分配权限")]),_:2},1032,["onClick"]),e(p,{type:"primary",size:"small",icon:"Edit",onClick:P=>K(a)},{default:t(()=>[u("编辑")]),_:2},1032,["onClick"]),e(X,{title:`你确定要删除${a.roleName}?`,width:"260px",onConfirm:P=>W(a.id)},{reference:t(()=>[e(p,{type:"primary",size:"small",icon:"Delete"},{default:t(()=>[u("删除")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(Z,{"current-page":s(c),"onUpdate:currentPage":l[1]||(l[1]=a=>k(c)?c.value=a:c=a),"page-size":s(b),"onUpdate:pageSize":l[2]||(l[2]=a=>k(b)?b.value=a:b=a),"page-sizes":[10,20,30,40],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:s(U),onCurrentChange:y,onSizeChange:M},null,8,["current-page","page-size","total"])]),_:1}),e(ee,{modelValue:s(f),"onUpdate:modelValue":l[5]||(l[5]=a=>k(f)?f.value=a:f=a),title:s(i).id?"更新职位":"添加职位"},{footer:t(()=>[e(p,{type:"primary",size:"default",onClick:l[4]||(l[4]=a=>k(f)?f.value=!1:f=!1)},{default:t(()=>[u("取消")]),_:1}),e(p,{type:"primary",size:"default",onClick:B},{default:t(()=>[u("确定")]),_:1})]),default:t(()=>[e(T,{model:s(i),rules:L,ref_key:"form",ref:x},{default:t(()=>[e(C,{label:"职位名称",prop:"roleName"},{default:t(()=>[e(n,{placeholder:"请你输入职位名称",modelValue:s(i).roleName,"onUpdate:modelValue":l[3]||(l[3]=a=>s(i).roleName=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(te,{modelValue:s(g),"onUpdate:modelValue":l[6]||(l[6]=a=>k(g)?g.value=a:g=a)},{header:t(()=>[ke]),default:t(()=>[e(le,{ref_key:"tree",ref:R,data:s(N),"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":s(V),props:G},null,8,["data","default-checked-keys"])]),footer:t(()=>[E("div",we,[e(p,{onClick:Q},{default:t(()=>[u("取消")]),_:1}),e(p,{type:"primary",onClick:J},{default:t(()=>[u("确定")]),_:1})])]),_:1},8,["modelValue"])],64)}}});const Re=ce(be,[["__scopeId","data-v-c502009f"]]);export{Re as default};
