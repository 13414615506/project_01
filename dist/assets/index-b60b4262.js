import{_ as ie,e as de,a as ue}from"./exportExcel-ea569a47.js";import{J as q,d as pe,u as he,r as i,c as ce,S as fe,G as ve,y as me,e as d,o as V,f as A,g as a,w as s,h as u,j as y,v as F,n as we,m as x,C as k,F as U,q as be,K as O,p as ge,k as _e,_ as Se}from"./index-c7a0cc4e.js";import{V as ye}from"./vue-draggable-next.esm-bundler-8be8cb1d.js";const ke=(c,g,n)=>q.post(`/admin/cop/getcoptgh/${c}/${g}`,n),xe=c=>q.post("/admin/cop/updateSkm",c),J=c=>(ge("data-v-3fab55db"),c=c(),_e(),c),Te={id:"elcheckbox"},Ce={class:"basicEx"},He=J(()=>x("span",null,"确认要执行此操作吗？",-1)),Ve=J(()=>x("br",null,null,-1)),De={slot:"footer",class:"dialog-footer"},Be=pe({__name:"index",setup(c){let g=he(),n=i(!1);const R=async()=>{(await xe(v)).code==200&&(O({type:"success",message:"确认收款成功"}),n.value=!1,_(f.value))},L=()=>{n.value=!1};let v=ce({}),f=i(1),w=i(10),M=i(0),I=i([]),h=i([]);fe(()=>{localStorage.getItem("coptghTableFilter")?(h.value=JSON.parse(localStorage.getItem("coptghTableFilter")||""),C(h.value)):h.value=p.value.map(t=>t.label)}),ve(async()=>{await _()});let P=i(g.buttons.includes("btn.copth.confirm"));const T=i("1"),D=i(window.innerHeight-316),Y={id:"1",index:1,condition:"equal",operate:"and",field:"",value:"",header:!0,checked:!0,pid:-1,floor:1},K=(t,e,l,r)=>{r=="Y"?O({type:"warning",message:"已收款无法再次确认收款"}):(v.xhdb=t,v.xhdh=e,v.xhxh=l,v.skm="Y",v.userid=g.username,v.confirmdate=j(!0),n.value=!0)};let j=t=>{let e=new Date,l=e.getFullYear(),r=e.getMonth()+1,b=e.getDate(),N=e.getHours(),z=e.getMinutes(),H=e.getSeconds(),S="";return t?S=l+"-"+m(r)+"-"+m(b)+" "+m(N)+":"+m(z)+":"+m(H):S=l+"-"+m(r)+"-"+m(b),S},m=t=>{let e;return t<10?e="0"+t:e=t,e};const G=[Object.assign({},Y)];let X=1;const Z=[{key:"销货单别",val:"TH001"},{key:"销货单号",val:"TH002"},{key:"销货序号",val:"TH003"},{key:"品号",val:"TH004"},{key:"品名",val:"TH005"},{key:"规格",val:"TH006"},{key:"客户品号",val:"TH019"},{key:"客户单号",val:"TC012"},{key:"预交日期",val:"TD013"},{key:"销货日期",val:"TG003"},{key:"收款码",val:"SKM"}],$={SKM:{dom:"select",data:[{key:"是",val:"Y"},{key:"否",val:"N"}]},MB109:{dom:"select",data:[{key:"已核准",val:"Y"},{key:"尚待核准",val:"y"},{key:"不准交易",val:"N"}]},TG003:{dom:"date"},TD013:{dom:"date"}},W=()=>{_()},_=async(t=1)=>{f.value=t;let e={conditions:[{}]};e.conditions.splice(0,1),G.forEach(r=>{e.conditions.push(r)});let l=await ke(f.value,w.value,e);l.code==200&&(M.value=l.data.total,l.data.records.forEach((r,b)=>{r.index=b+1+(f.value-1)*w.value}),I.value=l.data.records)},Q=()=>{_()},p=i([{strlen:18,label:"销货单号",prop:"XHDH",width:170,vhide:!0,orderby:!0,isShow:!0,sort:0},{strlen:12,label:"品号",prop:"TH004",width:120,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"品名",prop:"TH005",width:140,vhide:!0,isShow:!0,sort:0},{strlen:15,label:"规格",prop:"TH006",width:230,vhide:!0,isShow:!0,sort:0},{strlen:5,label:"销货日期",prop:"TG003",width:95,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"客户编号",prop:"TG004",width:85,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"客户简称",prop:"MA002",width:100,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"销货数量",prop:"TH008",width:85,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"单位",prop:"TH009",width:60,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"单价",prop:"TH012",width:85,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"金额",prop:"TH013",width:100,vhide:!1,isShow:!0,sort:0},{strlen:8,label:"订单号",prop:"DDDH",width:180,vhide:!0,isShow:!0,sort:0},{strlen:5,label:"订单数量",prop:"TD008",width:85,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"已交数量",prop:"TD009",width:85,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"预交货日",prop:"TD013",width:95,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"结束码",prop:"TD016",width:75,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"客户品号",prop:"TH019",width:85,vhide:!0,isShow:!0,sort:0},{strlen:5,label:"客户单号",prop:"TC012",width:85,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"人工单价",prop:"RGDJ",width:85,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"人工成本",prop:"RGCB",width:85,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"主材料单价",prop:"ZCLDJ",width:120,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"主材料成本",prop:"ZCLCB",width:120,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"包材单价",prop:"BCDJ",width:85,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"包材成本",prop:"BCCB",width:85,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"销售发票",prop:"XSFP",width:85,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"已开票数量",prop:"TH042",width:95,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"核销金额",prop:"TB044",width:100,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"收款码",prop:"SKM",width:75,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"确认收款人员",prop:"confirmAuthor",width:120,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"确认收款时间",prop:"confirmDate",width:120,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"操作",prop:"TB044",width:120,vhide:!1,isShow:!0,sort:0},{strlen:5,label:"picture",prop:"MB143",width:120,vhide:!1,isShow:!0,sort:0}]),ee=["TH013","TH008","TD008","TD009"],te=(t,e)=>(t.rowIndex+1)%2===0?"oddRow":"evenRow";me(T,(t,e)=>{T.value=="1"?D.value=window.innerHeight-316:D.value=window.innerHeight-228});const C=t=>{p.value.forEach(l=>{t.indexOf(l.label)!=-1?(l.isShow=!0,l.sort=t.indexOf(l.label)-t.length):l.isShow=!1}),p.value.sort((l,r)=>l.sort-r.sort),localStorage.setItem("coptghTableFilter",JSON.stringify(t));const e=t.length;B.value=e===p.value.length,E.value=e>0&&e<p.value.length},B=i(!1),E=i(!1),le=t=>{h.value=t?p.value.map(e=>e.label):[],E.value=!1,C(h.value)};return(t,e)=>{const l=d("el-button"),r=d("el-card"),b=d("el-collapse-item"),N=d("el-collapse"),z=d("Grid"),H=d("el-checkbox"),S=d("el-checkbox-group"),oe=d("el-popover"),ae=d("el-icon"),se=d("el-pagination"),re=d("el-dialog");return V(),A(U,null,[a(N,{modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=o=>T.value=o)},{default:s(()=>[a(b,{title:"查询条件",name:"1",style:{}},{default:s(()=>[a(r,{class:"form",style:{}},{default:s(()=>[a(ie,{floor:u(X),conditionList:G,"key-list":Z,"val-list":$},null,8,["floor"]),a(l,{type:"primary",size:"default",onClick:W},{default:s(()=>[y("查询")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(r,{style:{margin:"10px 0px"}},{default:s(()=>[u(g).buttons.includes("btn.copth.exportexcel")?(V(),F(l,{key:0,type:"primary",size:"default",onClick:e[1]||(e[1]=o=>u(de)("销货信息.xlsx","#coptgh-table"))},{default:s(()=>[y("导出EXCEL")]),_:1})):we("",!0),a(ae,{size:20,style:{float:"right","font-size":"33px","padding-right":"50px"},class:"grid"},{default:s(()=>[a(oe,{placement:"bottom",trigger:"hover",width:"80"},{reference:s(()=>[a(l,null,{default:s(()=>[a(z)]),_:1})]),default:s(()=>[x("div",Te,[x("div",Ce,[a(H,{modelValue:B.value,"onUpdate:modelValue":e[2]||(e[2]=o=>B.value=o),indeterminate:E.value,onChange:le},{default:s(()=>[y("全选")]),_:1},8,["modelValue","indeterminate"])]),a(S,{modelValue:u(h),"onUpdate:modelValue":e[4]||(e[4]=o=>k(h)?h.value=o:h=o),onChange:C,class:"checkbox-wrap"},{default:s(()=>[a(u(ye),{modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=o=>p.value=o),onEnd:C},{default:s(()=>[(V(!0),A(U,null,be(p.value,(o,ne)=>(V(),F(H,{key:ne,label:o.label,size:"large",style:{display:"block"}},null,8,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])])]),_:1})]),_:1}),a(ue,{id:"coptgh-table",tableData:u(I),height:D.value,columns:p.value,sumArray:ee,"row-class-name":te,checkVhide:!1,butPremission:u(P),onConfirmSkm:K},null,8,["tableData","height","columns","butPremission"]),a(se,{"current-page":u(f),"onUpdate:currentPage":e[5]||(e[5]=o=>k(f)?f.value=o:f=o),"page-size":u(w),"onUpdate:pageSize":e[6]||(e[6]=o=>k(w)?w.value=o:w=o),"page-sizes":[10,30,100,500,2e3],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:u(M),onCurrentChange:_,onSizeChange:Q},null,8,["current-page","page-size","total"])]),_:1}),a(re,{title:"确认收款",modelValue:u(n),"onUpdate:modelValue":e[8]||(e[8]=o=>k(n)?n.value=o:n=o),width:"30%","before-close":L},{default:s(()=>[He,Ve,x("span",De,[a(l,{onClick:e[7]||(e[7]=o=>k(n)?n.value=!1:n=!1)},{default:s(()=>[y("取 消")]),_:1}),a(l,{type:"primary",onClick:R},{default:s(()=>[y("确 定")]),_:1})])]),_:1},8,["modelValue"])],64)}}});const Me=Se(Be,[["__scopeId","data-v-3fab55db"]]);export{Me as default};
